<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Story Tailor v7.7.2 - Internal Multi-Key</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px 0;
    }
    .main-card {
      border-radius: 20px;
      border: none;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      background: white;
      overflow: hidden;
    }
    .card-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .api-management {
      background: #f1f3f5;
      padding: 10px 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .story-display {
      line-height: 2.4;
      font-size: 1.25rem;
      color: #333;
      padding: 30px;
      background: #ffffff;
      border-radius: 15px;
      margin-top: 20px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
    }
    .word-clickable {
      cursor: pointer;
      border-bottom: 2px dotted #667eea;
      transition: all 0.2s;
    }
    .word-clickable:hover {
      background-color: rgba(102, 126, 234, 0.1);
      color: #667eea;
      border-radius: 4px;
    }
    .tooltip-box {
      position: absolute;
      background: #1e293b;
      color: white;
      padding: 12px 18px;
      border-radius: 10px;
      display: none;
      pointer-events: none;
      z-index: 10000;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    .btn-generate {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      font-weight: 600;
      padding: 15px;
      border-radius: 12px;
      transition: all 0.2s;
    }
    .btn-generate:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
    #loading { display: none; }
    .status-badge { font-size: 0.75rem; padding: 4px 8px; border-radius: 20px; background: #d4edda; color: #155724; }
  </style>
</head>
<body>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card main-card">
        <div class="card-header">
          <h2>‚ú® AI Story Tailor v7.7.2</h2>
          <p class="mb-0 opacity-75">‡∏Ñ‡∏•‡∏≤‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 50 ‡∏Ñ‡∏ô | ‡∏£‡∏∞‡∏ö‡∏ö 5-Keys ‡∏ù‡∏±‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß</p>
        </div>
        
        <div class="api-management">
          <div><span class="status-badge">‚óè API System Ready (8B)</span></div>
          <button class="btn btn-link btn-sm text-muted" onclick="secureReset()">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
        </div>

        <div class="card-body p-4">
          <div class="mb-4">
            <label class="form-label fw-bold">üìù ‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ:</label>
            <input type="text" id="topic" class="form-control form-control-lg shadow-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤‡πÉ‡∏ô‡πÅ‡∏≠‡∏ü‡∏£‡∏¥‡∏Å‡∏≤, ‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏∞‡πÄ‡∏•...">
          </div>
          
          <button onclick="generate()" id="genBtn" class="btn btn-generate w-100 shadow">üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</button>

          <div id="loading" class="text-center my-5">
            <div class="spinner-border text-primary" style="width: 3.5rem; height: 3.5rem;"></div>
            <p class="mt-3 fw-bold text-secondary">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô... (‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß)</p>
          </div>

          <div id="storyOut" class="story-display mt-4 shadow-sm" style="display:none;"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="tbox" class="tooltip-box"></div>

<script>
  // ‡∏ù‡∏±‡∏á API Keys ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Array
  const INTERNAL_KEYS = [
    "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",
    "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",
    "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",
    "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",
    "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"
  ];

  function secureReset() {
    const pw = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï:");
    if(pw === "pass3") {
        localStorage.clear();
        alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        location.reload();
    } else { alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
  }

  async function generate() {
    const topic = document.getElementById('topic').value;
    if(!topic) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á');

    // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Key ‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ù‡∏±‡∏á‡πÑ‡∏ß‡πâ
    const skey = INTERNAL_KEYS[Math.floor(Math.random() * INTERNAL_KEYS.length)];
    
    const btn = document.getElementById('genBtn');
    const load = document.getElementById('loading');
    const out = document.getElementById('storyOut');

    btn.disabled = true;
    load.style.display = 'block';
    out.style.display = 'none';

    try {
      const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${skey}`, 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: "llama-3.1-8b-instant",
          messages: [{
            role: "user", 
            content: `Create a short English story for students about "${topic}" (Level A2). Use 3 simple paragraphs. No intro/outro.`
          }],
          temperature: 0.7
        })
      });

      const data = await res.json();
      if(data.error) throw new Error(data.error.message);
      
      render(data.choices[0].message.content);
      out.style.display = 'block';
      out.scrollIntoView({ behavior: 'smooth' });
    } catch(err) {
      alert("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢! ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠ 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏£‡∏±‡∏ö");
    } finally {
      btn.disabled = false;
      load.style.display = 'none';
    }
  }

  function render(txt) {
    const out = document.getElementById('storyOut');
    out.innerHTML = '';
    const paragraphs = txt.split('\n\n');
    paragraphs.forEach(pTxt => {
      const p = document.createElement('p');
      const words = pTxt.split(/(\s+)/);
      words.forEach(w => {
        if(/[a-zA-Z]/.test(w)) {
          const span = document.createElement('span');
          span.className = 'word-clickable';
          span.textContent = w;
          span.onmouseover = (e) => translate(e, w);
          span.onmouseout = () => document.getElementById('tbox').style.display='none';
          span.onclick = () => {
            const ut = new SpeechSynthesisUtterance(w.replace(/[^\w]/g,''));
            ut.lang = 'en-US';
            speechSynthesis.speak(ut);
          };
          p.appendChild(span);
        } else {
          p.appendChild(document.createTextNode(w));
        }
      });
      out.appendChild(p);
    });
  }

  async function translate(e, w) {
    const cw = w.replace(/[.,!?;:"]/g, '');
    const tb = document.getElementById('tbox');
    tb.style.display = 'block';
    tb.style.left = (e.pageX + 10) + 'px';
    tb.style.top = (e.pageY + 10) + 'px';
    tb.innerHTML = '...';
    try {
      const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=th&dt=t&q=${cw}`);
      const d = await r.json();
      tb.innerHTML = `<strong>${cw}</strong><br><span style="color:#fbbf24">‡πÅ‡∏õ‡∏•: ${d[0][0][0]}</span>`;
    } catch { tb.innerHTML = cw; }
  }
</script>
</body>
</html>
